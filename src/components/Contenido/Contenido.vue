<template>
  
    <div class="mdk-header-layout__content mt-5 pt-3">

        <div data-push data-responsive-width="992px" class="mdk-drawer-layout js-mdk-drawer-layout">
            <div class="mdk-drawer-layout__content page ">
                <div class="container-fluid page__container px-0 px-md-3">
                    <div class="card-group justify-content-center">
                        <div class="col-12 text-center">
                            <h4>Zona {{tema_actual.numero}}. {{tema_actual.nombre}} </h4>
                        </div>
                        <div class="stepwizard col-12">
                            <div class="stepwizard-row setup-panel">
                                <div class="stepwizard-step" v-for="seccion of tema_actual.secciones">
                                    <a href="" v-on:click.prevent="Ir_A_Seccion(seccion)" type="button" class="btn btn-circle text-white" style="background-color: rgba(0, 74, 143, 0.92) !important;" v-if="seccion.active">
                                        {{seccion.numero}}
                                    </a>
                                    <a href="" v-on:click.prevent="Ir_A_Seccion(seccion)" type="button" class="btn btn-circle btn-primary" v-else-if="seccion.completado">
                                        {{seccion.numero}}
                                    </a>
                                    <a href="" v-on:click.prevent="No_Hacer_Nada" type="button" class="btn btn-circle btn-default " v-else>
                                        {{seccion.numero}}
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="card">
                        <tema1seccion1 v-if="seccion_actual.componente=='1_1'"></tema1seccion1>
                        <tema1seccion2 v-if="seccion_actual.componente=='1_2'"></tema1seccion2>
                        <tema1seccion3 v-if="seccion_actual.componente=='1_3'"></tema1seccion3>
                        <tema1seccion4 v-if="seccion_actual.componente=='1_4'"></tema1seccion4>
                        <tema1seccion5 v-if="seccion_actual.componente=='1_5'"></tema1seccion5>
                        <tema1seccion6 v-if="seccion_actual.componente=='1_6'"></tema1seccion6>
                        <tema1seccion7 v-if="seccion_actual.componente=='1_7'"></tema1seccion7>
                        <tema2seccion1 v-if="seccion_actual.componente=='2_1'"></tema2seccion1>
                        <tema2seccion2 v-if="seccion_actual.componente=='2_2'"></tema2seccion2>
                        <tema3seccion1 v-if="seccion_actual.componente=='3_1'"></tema3seccion1>
                        <tema4seccion1 v-if="seccion_actual.componente=='4_1'"></tema4seccion1>
                        <tema4seccion2 v-if="seccion_actual.componente=='4_2'"></tema4seccion2>
                        <tema5seccion1 @CambiarActivo="Colocar_Seccion_Actual_Al_Cargar_La_Pagina" v-if="seccion_actual.componente=='5_1'"></tema5seccion1>
                        <div class="card-footer">
                            <a href="" v-on:click.prevent="Regresar" class="btn btn-primary" 
                            v-if="
                                seccion_actual.componente!='1_1' &&
                                seccion_actual.componente!='2_1' &&
                                seccion_actual.componente!='3_1' &&
                                seccion_actual.componente!='4_1' && 
                                seccion_actual.componente!='5_1'
                            ">
                                <i class="material-icons btn__icon--right mr-1">keyboard_backspace</i>
                                Regresar
                            </a>
                            <a href="" v-show="seccion_actual.componente!='5_1'" v-on:click.prevent="Continuar" class="btn btn-primary float-right">
                                Continuar <i class="material-icons btn__icon--right">play_arrow</i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mdk-drawer js-mdk-drawer" data-align="end">
                <div class="mdk-drawer__content ">
                    <div class="sidebar sidebar-right sidebar-light bg-white o-hidden" data-perfect-scrollbar>
                        <div class="sidebar-p-y">
                            <contadorview></contadorview>
                            <listatemasview @CambiarTema="Colocar_Seccion_Actual_Al_Cargar_La_Pagina"></listatemasview>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
</template>

<script>
import { mapActions } from 'vuex';
import Tema1Seccion1 from './Secciones/tema1seccion1.vue';
import Tema1Seccion2 from './Secciones/tema1seccion2.vue';
import Tema1Seccion3 from './Secciones/tema1seccion3.vue';
import Tema1Seccion4 from './Secciones/tema1seccion4.vue';
import Tema1Seccion5 from './Secciones/tema1seccion5.vue';
import Tema1Seccion6 from './Secciones/tema1seccion6.vue';
import Tema1Seccion7 from './Secciones/tema1seccion7.vue';
import Tema2Seccion1 from './Secciones/tema2seccion1.vue';
import Tema2Seccion2 from './Secciones/tema2seccion2.vue';
import Tema3Seccion1 from './Secciones/tema3seccion1.vue';
import Tema4Seccion1 from './Secciones/tema4seccion1.vue';
import Tema4Seccion2 from './Secciones/tema4seccion2.vue';
import Tema5Seccion1 from './Secciones/tema5seccion1.vue';
import ContadorView from './Contador.vue';
import ListaTemasView from './Lista_Temas.vue';
export default {
    components:{
        tema1seccion1:Tema1Seccion1,
        tema1seccion2:Tema1Seccion2,
        tema1seccion3:Tema1Seccion3,
        tema1seccion4:Tema1Seccion4,
        tema1seccion5:Tema1Seccion5,
        tema1seccion6:Tema1Seccion6,
        tema1seccion7:Tema1Seccion7,
        tema2seccion1:Tema2Seccion1,
        tema2seccion2:Tema2Seccion2,
        tema3seccion1:Tema3Seccion1, 
        tema4seccion1:Tema4Seccion1,
        tema4seccion2:Tema4Seccion2,
        tema5seccion1:Tema5Seccion1,        
        contadorview:ContadorView,
        listatemasview:ListaTemasView
    },
    data () {
        return {
          tema_actual:{
            nombre:'',
            numero:'',
            active:false,
            secciones:[]
          },
          seccion_actual:{
            componente:'1_1',
            numero_tema:1,
            numero_seccion:1
          }
        }
    },
    methods:{
        No_Hacer_Nada(){

        },
        Ir_A_Seccion(seccion){

            for (var x = 0; x < this.curso.temas[this.seccion_actual.numero_tema-1].secciones.length; x++) {
                this.curso.temas[this.seccion_actual.numero_tema-1].secciones[x].active=false;
                console.log(this.curso.temas[this.seccion_actual.numero_tema-1].secciones[x].numero+'=='+seccion.numero);
                if (this.curso.temas[this.seccion_actual.numero_tema-1].secciones[x].numero==seccion.numero) {
                    console.log('entre');
                    this.curso.temas[this.seccion_actual.numero_tema-1].secciones[x].active=true;
                }
            }
            
            this.Colocar_Seccion_Actual_Al_Cargar_La_Pagina();
        },
        Continuar(){
            if (this.curso.continuar) {
                this.Seccion_Completada({
                    numero_seccion:this.seccion_actual.numero_seccion,
                    numero_tema:this.seccion_actual.numero_tema
                });
                var siguiente_tema=this.seccion_actual.numero_tema;
                var siguiente_seccion=this.seccion_actual.numero_seccion+1;            
                if (this.seccion_actual.numero_seccion==this.tema_actual.secciones.length) {
                    siguiente_tema=this.seccion_actual.numero_tema+1;
                    siguiente_seccion=1;
                }
                this.seccion_actual.numero_tema=siguiente_tema;
                this.seccion_actual.numero_seccion=siguiente_seccion;
                this.seccion_actual.componente=siguiente_tema+'_'+siguiente_seccion;
                this.Colocar_Seccion_Actual();
                window.scrollTo(0, 0); 
            }else{
                alert('Todos las preguntas son obligatorias');
            }
        },
        Regresar(){
            var siguiente_tema=this.seccion_actual.numero_tema;
            var siguiente_seccion=this.seccion_actual.numero_seccion-1;
            this.seccion_actual.componente=siguiente_tema+'_'+siguiente_seccion;
            this.seccion_actual.numero_tema=siguiente_tema;
            this.seccion_actual.numero_seccion=siguiente_seccion;
            this.Colocar_Seccion_Actual();
        },
        Colocar_Seccion_Actual(){
            for (var i = 0; i < this.curso.temas.length; i++) {
                this.curso.temas[i].active=false;
                for (var x = 0; x < this.curso.temas[i].secciones.length; x++) {
                    this.curso.temas[i].secciones[x].active=false;
                    if (this.curso.temas[i].secciones[x].numero==this.seccion_actual.numero_seccion && this.curso.temas[i].numero==this.seccion_actual.numero_tema) {
                        this.curso.temas[i].active=true;
                        this.curso.temas[i].secciones[x].active=true;
                        this.tema_actual=this.curso.temas[i];
                    } 
                }
            }
            this.Guardar_En_LocalStorage();
            //this.Guardar_En_Firebase();
        },
        Colocar_Seccion_Actual_Al_Cargar_La_Pagina(){
            var curso_activo=false;
            for (var i = 0; i < this.curso.temas.length; i++) {
                if (this.curso.temas[i].active) {
                    for (var x = 0; x < this.curso.temas[i].secciones.length; x++) {
                        if (this.curso.temas[i].secciones[x].active) {
                            this.seccion_actual.componente=this.curso.temas[i].numero+'_'+this.curso.temas[i].secciones[x].numero;
                            this.seccion_actual.numero_tema=this.curso.temas[i].numero;
                            this.seccion_actual.numero_seccion=this.curso.temas[i].secciones[x].numero;
                            this.tema_actual=this.curso.temas[i];
                            curso_activo=true;
                        }
                    }
                }
            }
            if (!curso_activo) {
                this.curso.temas[0].active=true;
                this.curso.temas[0].secciones[0].active=true;
                this.seccion_actual.componente=this.curso.temas[0].numero+'_'+this.curso.temas[0].secciones[0].numero;
                this.seccion_actual.numero_tema=this.curso.temas[0].numero;
                this.seccion_actual.numero_seccion=this.curso.temas[0].secciones[0].numero;
                this.tema_actual=this.curso.temas[0];
            }
        },
        ...mapActions(['Seccion_Completada','Guardar_En_Firebase','Guardar_En_LocalStorage'])
    },
    mounted(){
        var that = this;
        $(document).ready(function(){
            setTimeout(function(){ 
                that.Colocar_Seccion_Actual_Al_Cargar_La_Pagina();
            }, 1000);
        });
    },
    computed:{
        curso(){
          return this.$store.getters.getCurso;
        }
    },
};
</script>
<style>
    
.stepwizard-step p {
    margin-top: 10px;
}
.stepwizard-row {
    display: table-row;
}
.stepwizard {
    display: table;
    width: 50%;
    position: relative;
}
.stepwizard-step button[disabled] {
    opacity: 1 !important;
    filter: alpha(opacity=100) !important;
}
.stepwizard-row:before {
    top: 14px;
    bottom: 0;
    position: absolute;
    content: " ";
    width: 100%;
    height: 1px;
    background-color: #ccc;
    z-order: 0;
}
.stepwizard-step {
    display: table-cell;
    text-align: center;
    position: relative;
}
.btn-circle {
    width: 30px;
    height: 30px;
    text-align: center;
    padding: 6px 0;
    font-size: 12px;
    line-height: 1.428571429;
    border-radius: 15px;
}
</style>